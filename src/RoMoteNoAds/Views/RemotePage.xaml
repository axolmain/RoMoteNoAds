<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:RoMoteNoAds.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="RoMoteNoAds.Views.RemotePage"
             x:DataType="vm:RemoteViewModel"
             Title="Remote"
             x:Name="ThisPage">

    <ContentPage.Resources>
        <!-- SF Symbol-style text for buttons (using system font glyphs where available) -->
        <Style x:Key="SymbolLabel" TargetType="Label">
            <Setter Property="FontFamily" Value="{OnPlatform iOS='SF Pro', MacCatalyst='SF Pro', Default=''}" />
            <Setter Property="HorizontalOptions" Value="Center" />
            <Setter Property="VerticalOptions" Value="Center" />
        </Style>
    </ContentPage.Resources>

    <!-- Main layout: Split view on wide screens, single column on phone -->
    <Grid ColumnDefinitions="{OnIdiom Phone='*', Tablet='2*,*', Desktop='2*,*'}"
          ColumnSpacing="{OnIdiom Phone=0, Default=24}"
          Padding="{OnIdiom Phone='16', Default='24'}">

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             LEFT SIDE: Remote Controls
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Grid Grid.Column="0"
              RowDefinitions="Auto,*,Auto"
              MaximumWidthRequest="{OnIdiom Phone=500, Default=450}"
              HorizontalOptions="{OnIdiom Phone=Fill, Default=Center}">

            <!-- Error Banner -->
            <Border Grid.Row="0"
                    BackgroundColor="{StaticResource SystemRed}"
                    Padding="12,8"
                    StrokeShape="RoundRectangle 8"
                    Margin="0,0,0,12"
                    IsVisible="{Binding ErrorMessage, Converter={toolkit:IsStringNotNullOrEmptyConverter}}">
                <Label Text="{Binding ErrorMessage}"
                       TextColor="White"
                       FontSize="13"
                       HorizontalOptions="Center" />
            </Border>

            <!-- Top Bar: Power + Device Name (Phone only - tablet shows in sidebar) -->
            <Grid Grid.Row="0"
                  ColumnDefinitions="Auto,*,Auto"
                  Margin="0,0,0,16"
                  IsVisible="{OnIdiom Phone=True, Default=False}">
                <Button Grid.Column="0"
                        Text="â»"
                        Command="{Binding PowerToggleCommand}"
                        Style="{StaticResource PowerButton}" />
                <Label Grid.Column="1"
                       Text="{Binding CurrentDevice.DisplayName, FallbackValue='No Device'}"
                       Style="{StaticResource SubtitleLabel}"
                       VerticalOptions="Center"
                       HorizontalOptions="Center"
                       MaxLines="1"
                       LineBreakMode="TailTruncation" />
                <BoxView Grid.Column="2" WidthRequest="44" HeightRequest="44" Color="Transparent" />
            </Grid>

            <!-- Main Remote Controls -->
            <Grid Grid.Row="1"
                  RowDefinitions="*,Auto,*"
                  ColumnDefinitions="Auto,*,Auto"
                  VerticalOptions="Center">

                <!-- Volume Down (left side) -->
                <VerticalStackLayout Grid.Row="1" Grid.Column="0"
                                     Spacing="8"
                                     Margin="0,0,16,0"
                                     VerticalOptions="Center">
                    <Button Text="+"
                            Command="{Binding VolumeUpCommand}"
                            Style="{StaticResource VolumeButton}" />
                    <Button Text="âˆ’"
                            Command="{Binding VolumeDownCommand}"
                            Style="{StaticResource VolumeButton}" />
                    <Button Text="ðŸ”‡"
                            Command="{Binding VolumeMuteCommand}"
                            Style="{StaticResource ActionButton}"
                            WidthRequest="44"
                            HeightRequest="44" />
                </VerticalStackLayout>

                <!-- D-Pad (center) -->
                <Grid Grid.Row="1" Grid.Column="1"
                      RowDefinitions="60,80,60"
                      ColumnDefinitions="60,80,60"
                      RowSpacing="8"
                      ColumnSpacing="8"
                      HorizontalOptions="Center"
                      VerticalOptions="Center">

                    <!-- Up -->
                    <Button Grid.Row="0" Grid.Column="1"
                            Text="â–²"
                            Command="{Binding PressUpCommand}"
                            Style="{StaticResource DPadButton}" />

                    <!-- Left -->
                    <Button Grid.Row="1" Grid.Column="0"
                            Text="â—€"
                            Command="{Binding PressLeftCommand}"
                            Style="{StaticResource DPadButton}" />

                    <!-- OK/Select (accent color) -->
                    <Button Grid.Row="1" Grid.Column="1"
                            Text="OK"
                            Command="{Binding PressSelectCommand}"
                            Style="{StaticResource DPadCenterButton}" />

                    <!-- Right -->
                    <Button Grid.Row="1" Grid.Column="2"
                            Text="â–¶"
                            Command="{Binding PressRightCommand}"
                            Style="{StaticResource DPadButton}" />

                    <!-- Down -->
                    <Button Grid.Row="2" Grid.Column="1"
                            Text="â–¼"
                            Command="{Binding PressDownCommand}"
                            Style="{StaticResource DPadButton}" />
                </Grid>

                <!-- Power button (right side, tablet/desktop) -->
                <Button Grid.Row="0" Grid.Column="2"
                        Text="â»"
                        Command="{Binding PowerToggleCommand}"
                        Style="{StaticResource PowerButton}"
                        IsVisible="{OnIdiom Phone=False, Default=True}"
                        VerticalOptions="End"
                        Margin="16,0,0,0" />
            </Grid>

            <!-- Bottom Controls -->
            <VerticalStackLayout Grid.Row="2" Spacing="12" Margin="0,16,0,0">

                <!-- Playback Controls -->
                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12" HorizontalOptions="Center">
                    <Button Grid.Column="0"
                            Text="âª"
                            Command="{Binding PressRewindCommand}"
                            Style="{StaticResource PlaybackButton}" />
                    <Button Grid.Column="1"
                            Text="â–¶â¸"
                            Command="{Binding PressPlayCommand}"
                            Style="{StaticResource PlaybackButton}"
                            BackgroundColor="{StaticResource AccentColor}"
                            TextColor="White" />
                    <Button Grid.Column="2"
                            Text="â©"
                            Command="{Binding PressFastForwardCommand}"
                            Style="{StaticResource PlaybackButton}" />
                </Grid>

                <!-- Action Row: Home, Back, Star, Search -->
                <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="12" HorizontalOptions="Center" MaximumWidthRequest="280">
                    <Button Grid.Column="0"
                            Text="âŒ‚"
                            Command="{Binding PressHomeCommand}"
                            Style="{StaticResource ActionButton}"
                            FontSize="22" />
                    <Button Grid.Column="1"
                            Text="â—"
                            Command="{Binding PressBackCommand}"
                            Style="{StaticResource ActionButton}"
                            FontSize="20" />
                    <Button Grid.Column="2"
                            Text="â˜…"
                            Command="{Binding PressInfoCommand}"
                            Style="{StaticResource ActionButton}"
                            FontSize="18" />
                    <Button Grid.Column="3"
                            Text="âŒ•"
                            Command="{Binding PressSearchCommand}"
                            Style="{StaticResource ActionButton}"
                            FontSize="20" />
                </Grid>

                <!-- Utility Row -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12" HorizontalOptions="Center" MaximumWidthRequest="320">
                    <Button Grid.Column="0"
                            Text="â†» Replay"
                            Command="{Binding PressReplayCommand}"
                            Style="{StaticResource UtilityButton}"
                            HorizontalOptions="Fill" />
                    <Button Grid.Column="1"
                            Text="âŒ¨ Keyboard"
                            Command="{Binding ShowKeyboardCommand}"
                            Style="{StaticResource UtilityButton}"
                            HorizontalOptions="Fill" />
                </Grid>
            </VerticalStackLayout>
        </Grid>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             RIGHT SIDE: Now Playing Panel (Tablet/Desktop only)
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Frame Grid.Column="1"
               Style="{StaticResource CardFrame}"
               IsVisible="{OnIdiom Phone=False, Default=True}"
               Padding="20"
               VerticalOptions="Center"
               MaximumHeightRequest="400">
            <VerticalStackLayout Spacing="16">

                <!-- Now Playing Header -->
                <Label Text="Now Playing"
                       Style="{StaticResource HeadlineLabel}" />

                <!-- Active Channel Display -->
                <VerticalStackLayout Spacing="12"
                                     IsVisible="{Binding ActiveChannel, Converter={toolkit:IsNotNullConverter}}">
                    <Border StrokeThickness="0"
                            HeightRequest="120"
                            WidthRequest="120"
                            HorizontalOptions="Center">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="16" />
                        </Border.StrokeShape>
                        <Image Source="{Binding ActiveChannel.IconSource}"
                               Aspect="AspectFit" />
                    </Border>
                    <Label Text="{Binding ActiveChannel.Name}"
                           Style="{StaticResource BodyLabel}"
                           HorizontalOptions="Center"
                           FontAttributes="Bold" />
                </VerticalStackLayout>

                <!-- No Active Channel -->
                <VerticalStackLayout Spacing="8"
                                     IsVisible="{Binding ActiveChannel, Converter={toolkit:IsNullConverter}}"
                                     HorizontalOptions="Center">
                    <Label Text="ðŸ“º"
                           FontSize="48"
                           HorizontalOptions="Center" />
                    <Label Text="Nothing playing"
                           Style="{StaticResource SubtitleLabel}"
                           HorizontalOptions="Center" />
                </VerticalStackLayout>

                <!-- Separator -->
                <BoxView HeightRequest="1"
                         Color="{AppThemeBinding Light={StaticResource SeparatorLight}, Dark={StaticResource SeparatorDark}}"
                         Margin="0,8" />

                <!-- Device Info -->
                <VerticalStackLayout Spacing="4">
                    <Label Text="Connected Device"
                           Style="{StaticResource CaptionLabel}" />
                    <Label Text="{Binding CurrentDevice.DisplayName, FallbackValue='No device selected'}"
                           Style="{StaticResource BodyLabel}" />
                    <Label Text="{Binding CurrentDevice.IpAddress}"
                           Style="{StaticResource SubtitleLabel}"
                           IsVisible="{Binding CurrentDevice, Converter={toolkit:IsNotNullConverter}}" />
                </VerticalStackLayout>

            </VerticalStackLayout>
        </Frame>

        <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
             Keyboard Modal Overlay
             â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
        <Grid Grid.ColumnSpan="2"
              IsVisible="{Binding IsKeyboardVisible}"
              BackgroundColor="{AppThemeBinding Light=#80F2F2F7, Dark=#80000000}"
              InputTransparent="False">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Command="{Binding HideKeyboardCommand}" />
            </Grid.GestureRecognizers>

            <Frame Style="{StaticResource CardFrame}"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"
                   WidthRequest="340"
                   Padding="24">
                <Frame.GestureRecognizers>
                    <TapGestureRecognizer />
                </Frame.GestureRecognizers>

                <VerticalStackLayout Spacing="20">
                    <Label Text="Enter Text"
                           Style="{StaticResource TitleLabel}"
                           HorizontalOptions="Center" />

                    <Entry Placeholder="Type here..."
                           Text="{Binding KeyboardText}"
                           ReturnCommand="{Binding SendKeyboardTextCommand}"
                           ReturnType="Send" />

                    <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="12">
                        <Button Grid.Column="0"
                                Text="âŒ«"
                                Command="{Binding SendBackspaceCommand}"
                                Style="{StaticResource SecondaryButton}"
                                WidthRequest="60"
                                HeightRequest="44" />
                        <Button Grid.Column="1"
                                Text="Send"
                                Command="{Binding SendKeyboardTextCommand}"
                                Style="{StaticResource PrimaryButton}"
                                HeightRequest="44" />
                        <Button Grid.Column="2"
                                Text="Cancel"
                                Command="{Binding HideKeyboardCommand}"
                                Style="{StaticResource SecondaryButton}"
                                WidthRequest="80"
                                HeightRequest="44" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>
