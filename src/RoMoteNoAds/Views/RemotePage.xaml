<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:RoMoteNoAds.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="RoMoteNoAds.Views.RemotePage"
             x:DataType="vm:RemoteViewModel"
             Title="Remote">

    <Grid RowDefinitions="Auto,*" Padding="16">
        <!-- Error Banner -->
        <Border Grid.Row="0"
                BackgroundColor="{StaticResource Error}"
                Padding="12,8"
                StrokeShape="RoundRectangle 8"
                IsVisible="{Binding ErrorMessage, Converter={toolkit:IsStringNotNullOrEmptyConverter}}">
            <Label Text="{Binding ErrorMessage}"
                   TextColor="White"
                   FontSize="12"
                   HorizontalOptions="Center" />
        </Border>

        <!-- Main Remote Layout -->
        <Grid Grid.Row="1" Padding="0,8,0,0">
            <!-- Glass Remote Card (centered) -->
            <Frame Style="{StaticResource GlassCard}"
                   HorizontalOptions="Center"
                   VerticalOptions="Start"
                   MaximumWidthRequest="340">
                <VerticalStackLayout Spacing="20">

                    <!-- Top Bar: Power + Device Name -->
                    <Grid ColumnDefinitions="Auto,*">
                        <!-- Power Button -->
                        <Button Grid.Column="0"
                                Text="â»"
                                Command="{Binding PowerToggleCommand}"
                                Style="{StaticResource PowerButton}"
                                IsVisible="{Binding SupportsPower}" />

                        <!-- Device Name -->
                        <Label Grid.Column="1"
                               Text="{Binding CurrentDevice.DisplayName, FallbackValue='No Device'}"
                               Style="{StaticResource SubtitleLabel}"
                               VerticalOptions="Center"
                               HorizontalOptions="End"
                               MaxLines="1"
                               LineBreakMode="TailTruncation" />
                    </Grid>

                    <!-- D-Pad with Volume Strip -->
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="16">
                        <!-- D-Pad -->
                        <Grid Grid.Column="0"
                              RowDefinitions="56,70,56"
                              ColumnDefinitions="56,70,56"
                              RowSpacing="8"
                              ColumnSpacing="8"
                              HorizontalOptions="Center">

                            <!-- Up -->
                            <Button Grid.Row="0" Grid.Column="1"
                                    Text="â–²"
                                    Command="{Binding PressUpCommand}"
                                    Style="{StaticResource GlassDPadButton}" />

                            <!-- Left -->
                            <Button Grid.Row="1" Grid.Column="0"
                                    Text="â—€"
                                    Command="{Binding PressLeftCommand}"
                                    Style="{StaticResource GlassDPadButton}" />

                            <!-- OK/Select -->
                            <Button Grid.Row="1" Grid.Column="1"
                                    Text="OK"
                                    Command="{Binding PressSelectCommand}"
                                    Style="{StaticResource GlassDPadCenterButton}" />

                            <!-- Right -->
                            <Button Grid.Row="1" Grid.Column="2"
                                    Text="â–¶"
                                    Command="{Binding PressRightCommand}"
                                    Style="{StaticResource GlassDPadButton}" />

                            <!-- Down -->
                            <Button Grid.Row="2" Grid.Column="1"
                                    Text="â–¼"
                                    Command="{Binding PressDownCommand}"
                                    Style="{StaticResource GlassDPadButton}" />
                        </Grid>

                        <!-- Volume Strip (right edge) -->
                        <Frame Grid.Column="1"
                               Style="{StaticResource VolumePillFrame}"
                               IsVisible="{Binding SupportsVolume}"
                               VerticalOptions="Center">
                            <VerticalStackLayout Spacing="4">
                                <Button Text="+"
                                        Command="{Binding VolumeUpCommand}"
                                        Style="{StaticResource GlassVolumeButton}" />
                                <Button Text="ðŸ”‡"
                                        Command="{Binding VolumeMuteCommand}"
                                        Style="{StaticResource GlassVolumeButton}"
                                        FontSize="14" />
                                <Button Text="âˆ’"
                                        Command="{Binding VolumeDownCommand}"
                                        Style="{StaticResource GlassVolumeButton}" />
                            </VerticalStackLayout>
                        </Frame>
                    </Grid>

                    <!-- Playback Controls -->
                    <HorizontalStackLayout Spacing="20" HorizontalOptions="Center">
                        <Button Text="âª"
                                Command="{Binding PressRewindCommand}"
                                Style="{StaticResource GlassPlaybackButton}" />
                        <Button Text="â–¶âšâš"
                                Command="{Binding PressPlayCommand}"
                                Style="{StaticResource GlassPlaybackButton}"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="White"
                                WidthRequest="64"
                                FontSize="14" />
                        <Button Text="â©"
                                Command="{Binding PressFastForwardCommand}"
                                Style="{StaticResource GlassPlaybackButton}" />
                    </HorizontalStackLayout>

                    <!-- Action Row: Home, Back, Star, Search -->
                    <HorizontalStackLayout Spacing="16" HorizontalOptions="Center">
                        <Button Text="ðŸ "
                                Command="{Binding PressHomeCommand}"
                                Style="{StaticResource GlassActionButton}" />
                        <Button Text="â†"
                                Command="{Binding PressBackCommand}"
                                Style="{StaticResource GlassActionButton}"
                                FontSize="22" />
                        <Button Text="â˜…"
                                Command="{Binding PressInfoCommand}"
                                Style="{StaticResource GlassActionButton}" />
                        <Button Text="ðŸ”"
                                Command="{Binding PressSearchCommand}"
                                Style="{StaticResource GlassActionButton}" />
                    </HorizontalStackLayout>

                    <!-- Utility Row -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <Button Grid.Column="0"
                                Text="â†º Replay"
                                Command="{Binding PressReplayCommand}"
                                Style="{StaticResource GlassUtilityButton}" />
                        <Button Grid.Column="1"
                                Text="âŒ¨ Keyboard"
                                Command="{Binding ShowKeyboardCommand}"
                                Style="{StaticResource GlassUtilityButton}" />
                    </Grid>

                </VerticalStackLayout>
            </Frame>
        </Grid>

        <!-- Keyboard Overlay -->
        <Grid Grid.RowSpan="2"
              IsVisible="{Binding IsKeyboardVisible}"
              BackgroundColor="{AppThemeBinding Light=#80FFFFFF, Dark=#80000000}">
            <Frame Style="{StaticResource GlassCard}"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"
                   WidthRequest="320"
                   Padding="20">
                <VerticalStackLayout Spacing="16">
                    <Label Text="Enter Text"
                           Style="{StaticResource TitleLabel}"
                           HorizontalOptions="Center" />

                    <Entry Placeholder="Type here..."
                           Text="{Binding KeyboardText}"
                           ReturnCommand="{Binding SendKeyboardTextCommand}" />

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                        <Button Grid.Column="0"
                                Text="âŒ«"
                                Command="{Binding SendBackspaceCommand}"
                                Style="{StaticResource GlassUtilityButton}" />
                        <Button Grid.Column="1"
                                Text="Send"
                                Command="{Binding SendKeyboardTextCommand}"
                                Style="{StaticResource PrimaryButton}"
                                HeightRequest="40" />
                        <Button Grid.Column="2"
                                Text="Cancel"
                                Command="{Binding HideKeyboardCommand}"
                                Style="{StaticResource GlassUtilityButton}" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>
