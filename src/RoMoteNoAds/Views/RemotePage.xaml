<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:RoMoteNoAds.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="RoMoteNoAds.Views.RemotePage"
             x:DataType="vm:RemoteViewModel"
             Title="Remote">

    <ContentPage.Resources>
        <Style x:Key="RemoteButton" TargetType="Button">
            <Setter Property="BackgroundColor" Value="{AppThemeBinding Light={StaticResource CardBackgroundLight}, Dark={StaticResource CardBackgroundDark}}" />
            <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource TextPrimaryLight}, Dark={StaticResource TextPrimaryDark}}" />
            <Setter Property="FontSize" Value="20" />
            <Setter Property="CornerRadius" Value="12" />
            <Setter Property="HeightRequest" Value="56" />
            <Setter Property="WidthRequest" Value="56" />
            <Setter Property="Padding" Value="0" />
        </Style>

        <Style x:Key="ActionButton" TargetType="Button">
            <Setter Property="BackgroundColor" Value="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" />
            <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource TextPrimaryLight}, Dark={StaticResource TextPrimaryDark}}" />
            <Setter Property="FontSize" Value="14" />
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="HeightRequest" Value="48" />
            <Setter Property="Padding" Value="16,0" />
        </Style>

        <Style x:Key="VolumeButton" TargetType="Button">
            <Setter Property="BackgroundColor" Value="{AppThemeBinding Light={StaticResource Gray200}, Dark={StaticResource Gray600}}" />
            <Setter Property="TextColor" Value="{AppThemeBinding Light={StaticResource TextPrimaryLight}, Dark={StaticResource TextPrimaryDark}}" />
            <Setter Property="FontSize" Value="18" />
            <Setter Property="CornerRadius" Value="10" />
            <Setter Property="HeightRequest" Value="50" />
            <Setter Property="WidthRequest" Value="50" />
        </Style>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*" Padding="16">
        <!-- Header with device info and error -->
        <VerticalStackLayout Grid.Row="0" Spacing="8">
            <!-- Device Name -->
            <Label Text="{Binding CurrentDevice.DisplayName, FallbackValue='No Device Connected'}"
                   Style="{StaticResource SubtitleLabel}"
                   HorizontalOptions="Center" />

            <!-- Error Message -->
            <Border BackgroundColor="{StaticResource Error}"
                   Padding="12,8"
                   IsVisible="{Binding ErrorMessage, Converter={toolkit:IsStringNotNullOrEmptyConverter}}">
                <Label Text="{Binding ErrorMessage}"
                       TextColor="White"
                       FontSize="12"
                       HorizontalOptions="Center" />
            </Border>
        </VerticalStackLayout>

        <!-- Main Remote Controls -->
        <ScrollView Grid.Row="1" Padding="0,16,0,0">
            <VerticalStackLayout Spacing="20">

                <!-- Power and Volume Row -->
                <Grid ColumnDefinitions="*,Auto,*"
                      IsVisible="{Binding SupportsPower}">
                    <!-- Power Button -->
                    <Button Grid.Column="0"
                            Text="â»"
                            Command="{Binding PowerToggleCommand}"
                            Style="{StaticResource RemoteButton}"
                            BackgroundColor="{StaticResource Error}"
                            TextColor="White"
                            HorizontalOptions="Start" />

                    <!-- Volume Controls -->
                    <VerticalStackLayout Grid.Column="2"
                                        Spacing="8"
                                        HorizontalOptions="End"
                                        IsVisible="{Binding SupportsVolume}">
                        <Button Text="+"
                                Command="{Binding VolumeUpCommand}"
                                Style="{StaticResource VolumeButton}" />
                        <Button Text="ðŸ”‡"
                                Command="{Binding VolumeMuteCommand}"
                                Style="{StaticResource VolumeButton}"
                                FontSize="16" />
                        <Button Text="-"
                                Command="{Binding VolumeDownCommand}"
                                Style="{StaticResource VolumeButton}" />
                    </VerticalStackLayout>
                </Grid>

                <!-- D-Pad Card -->
                <Frame Style="{StaticResource CardFrame}"
                       Padding="24"
                       HorizontalOptions="Center">
                    <Grid RowDefinitions="60,70,60"
                          ColumnDefinitions="60,70,60"
                          RowSpacing="8"
                          ColumnSpacing="8">

                        <!-- Up Button -->
                        <Button Grid.Row="0" Grid.Column="1"
                                Text="â–²"
                                Command="{Binding PressUpCommand}"
                                Style="{StaticResource DPadDirectionButton}" />

                        <!-- Left Button -->
                        <Button Grid.Row="1" Grid.Column="0"
                                Text="â—€"
                                Command="{Binding PressLeftCommand}"
                                Style="{StaticResource DPadDirectionButton}" />

                        <!-- OK/Select Button -->
                        <Button Grid.Row="1" Grid.Column="1"
                                Text="OK"
                                Command="{Binding PressSelectCommand}"
                                Style="{StaticResource DPadCenterButton}" />

                        <!-- Right Button -->
                        <Button Grid.Row="1" Grid.Column="2"
                                Text="â–¶"
                                Command="{Binding PressRightCommand}"
                                Style="{StaticResource DPadDirectionButton}" />

                        <!-- Down Button -->
                        <Button Grid.Row="2" Grid.Column="1"
                                Text="â–¼"
                                Command="{Binding PressDownCommand}"
                                Style="{StaticResource DPadDirectionButton}" />
                    </Grid>
                </Frame>

                <!-- Playback Controls -->
                <Frame Style="{StaticResource CardFrame}"
                       Padding="16"
                       HorizontalOptions="Center">
                    <HorizontalStackLayout Spacing="16">
                        <Button Text="âª"
                                Command="{Binding PressRewindCommand}"
                                Style="{StaticResource RemoteButton}"
                                FontSize="24" />
                        <Button Text="â–¶âšâš"
                                Command="{Binding PressPlayCommand}"
                                Style="{StaticResource RemoteButton}"
                                WidthRequest="70"
                                BackgroundColor="{StaticResource Primary}"
                                TextColor="White"
                                FontSize="16" />
                        <Button Text="â©"
                                Command="{Binding PressFastForwardCommand}"
                                Style="{StaticResource RemoteButton}"
                                FontSize="24" />
                    </HorizontalStackLayout>
                </Frame>

                <!-- Instant Replay -->
                <Button Text="â†º Replay"
                        Command="{Binding PressReplayCommand}"
                        Style="{StaticResource ActionButton}"
                        HorizontalOptions="Center" />

                <!-- Action Buttons Row -->
                <Grid ColumnDefinitions="*,*,*,*"
                      ColumnSpacing="12"
                      HorizontalOptions="Center">
                    <Button Grid.Column="0"
                            Text="ðŸ "
                            Command="{Binding PressHomeCommand}"
                            Style="{StaticResource ActionButton}"
                            FontSize="18" />
                    <Button Grid.Column="1"
                            Text="â†"
                            Command="{Binding PressBackCommand}"
                            Style="{StaticResource ActionButton}"
                            FontSize="18" />
                    <Button Grid.Column="2"
                            Text="â„¹ï¸"
                            Command="{Binding PressInfoCommand}"
                            Style="{StaticResource ActionButton}"
                            FontSize="18" />
                    <Button Grid.Column="3"
                            Text="ðŸ”"
                            Command="{Binding PressSearchCommand}"
                            Style="{StaticResource ActionButton}"
                            FontSize="18" />
                </Grid>

                <!-- Keyboard Input Button -->
                <Button Text="âŒ¨ Keyboard"
                        Command="{Binding ShowKeyboardCommand}"
                        Style="{StaticResource PrimaryButton}"
                        HorizontalOptions="Center"
                        WidthRequest="200" />

            </VerticalStackLayout>
        </ScrollView>

        <!-- Keyboard Overlay -->
        <Grid Grid.RowSpan="2"
              IsVisible="{Binding IsKeyboardVisible}"
              BackgroundColor="{AppThemeBinding Light=#80FFFFFF, Dark=#80000000}">
            <Frame Style="{StaticResource CardFrame}"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"
                   WidthRequest="320"
                   Padding="20">
                <VerticalStackLayout Spacing="16">
                    <Label Text="Enter Text"
                           Style="{StaticResource TitleLabel}"
                           HorizontalOptions="Center" />

                    <Entry Placeholder="Type here..."
                           Text="{Binding KeyboardText}"
                           ReturnCommand="{Binding SendKeyboardTextCommand}" />

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                        <Button Grid.Column="0"
                                Text="âŒ«"
                                Command="{Binding SendBackspaceCommand}"
                                Style="{StaticResource ActionButton}" />
                        <Button Grid.Column="1"
                                Text="Send"
                                Command="{Binding SendKeyboardTextCommand}"
                                Style="{StaticResource PrimaryButton}" />
                        <Button Grid.Column="2"
                                Text="Cancel"
                                Command="{Binding HideKeyboardCommand}"
                                Style="{StaticResource ActionButton}" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>
