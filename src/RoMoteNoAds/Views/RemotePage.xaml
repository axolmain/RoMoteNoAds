<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:RoMoteNoAds.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="RoMoteNoAds.Views.RemotePage"
             x:DataType="vm:RemoteViewModel"
             Title="Remote">

    <Grid RowDefinitions="Auto,*,Auto" Padding="20">
        <!-- Error Banner -->
        <Border Grid.Row="0"
                BackgroundColor="{StaticResource Error}"
                Padding="12,8"
                StrokeShape="RoundRectangle 8"
                Margin="0,0,0,12"
                IsVisible="{Binding ErrorMessage, Converter={toolkit:IsStringNotNullOrEmptyConverter}}">
            <Label Text="{Binding ErrorMessage}"
                   TextColor="White"
                   FontSize="12"
                   HorizontalOptions="Center" />
        </Border>

        <!-- Top Bar: Power + Device Name -->
        <Grid Grid.Row="0" ColumnDefinitions="Auto,*,Auto" Margin="0,0,0,20">
            <!-- Power Button -->
            <Button Grid.Column="0"
                    Text="â»"
                    Command="{Binding PowerToggleCommand}"
                    Style="{StaticResource PowerButton}" />

            <!-- Device Name -->
            <Label Grid.Column="1"
                   Text="{Binding CurrentDevice.DisplayName, FallbackValue='No Device'}"
                   Style="{StaticResource SubtitleLabel}"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"
                   MaxLines="1"
                   LineBreakMode="TailTruncation" />

            <!-- Placeholder for symmetry -->
            <BoxView Grid.Column="2" WidthRequest="44" HeightRequest="44" Color="Transparent" />
        </Grid>

        <!-- Main Remote Controls -->
        <Grid Grid.Row="1" RowDefinitions="*,Auto,*" ColumnDefinitions="Auto,*,Auto">

            <!-- Volume Down (left side) -->
            <Button Grid.Row="1" Grid.Column="0"
                    Text="âˆ’"
                    Command="{Binding VolumeDownCommand}"
                    Style="{StaticResource GlassDPadButton}"
                    WidthRequest="50"
                    HeightRequest="50"
                    Margin="0,0,20,0" />

            <!-- D-Pad (center) -->
            <Grid Grid.Row="1" Grid.Column="1"
                  RowDefinitions="70,90,70"
                  ColumnDefinitions="70,90,70"
                  RowSpacing="8"
                  ColumnSpacing="8"
                  HorizontalOptions="Center"
                  VerticalOptions="Center">

                <!-- Up -->
                <Button Grid.Row="0" Grid.Column="1"
                        Text="â–²"
                        Command="{Binding PressUpCommand}"
                        Style="{StaticResource GlassDPadButton}" />

                <!-- Left -->
                <Button Grid.Row="1" Grid.Column="0"
                        Text="â—€"
                        Command="{Binding PressLeftCommand}"
                        Style="{StaticResource GlassDPadButton}" />

                <!-- OK/Select -->
                <Button Grid.Row="1" Grid.Column="1"
                        Text="OK"
                        Command="{Binding PressSelectCommand}"
                        Style="{StaticResource GlassDPadCenterButton}" />

                <!-- Right -->
                <Button Grid.Row="1" Grid.Column="2"
                        Text="â–¶"
                        Command="{Binding PressRightCommand}"
                        Style="{StaticResource GlassDPadButton}" />

                <!-- Down -->
                <Button Grid.Row="2" Grid.Column="1"
                        Text="â–¼"
                        Command="{Binding PressDownCommand}"
                        Style="{StaticResource GlassDPadButton}" />
            </Grid>

            <!-- Volume Up (right side) -->
            <Button Grid.Row="1" Grid.Column="2"
                    Text="+"
                    Command="{Binding VolumeUpCommand}"
                    Style="{StaticResource GlassDPadButton}"
                    WidthRequest="50"
                    HeightRequest="50"
                    Margin="20,0,0,0" />

            <!-- Mute button (below volume down) -->
            <Button Grid.Row="2" Grid.Column="0"
                    Text="ðŸ”‡"
                    Command="{Binding VolumeMuteCommand}"
                    Style="{StaticResource GlassActionButton}"
                    VerticalOptions="Start"
                    Margin="0,20,20,0" />
        </Grid>

        <!-- Bottom Controls -->
        <VerticalStackLayout Grid.Row="2" Spacing="16">
            <!-- Playback Controls -->
            <Grid ColumnDefinitions="*,*,*" ColumnSpacing="12">
                <Button Grid.Column="0"
                        Text="âª"
                        Command="{Binding PressRewindCommand}"
                        Style="{StaticResource GlassPlaybackButton}"
                        HorizontalOptions="Fill"
                        HeightRequest="50" />
                <Button Grid.Column="1"
                        Text="â–¶âšâš"
                        Command="{Binding PressPlayCommand}"
                        Style="{StaticResource GlassPlaybackButton}"
                        BackgroundColor="{StaticResource Primary}"
                        TextColor="White"
                        HorizontalOptions="Fill"
                        HeightRequest="50" />
                <Button Grid.Column="2"
                        Text="â©"
                        Command="{Binding PressFastForwardCommand}"
                        Style="{StaticResource GlassPlaybackButton}"
                        HorizontalOptions="Fill"
                        HeightRequest="50" />
            </Grid>

            <!-- Action Row: Home, Back, Star, Search -->
            <Grid ColumnDefinitions="*,*,*,*" ColumnSpacing="12">
                <Button Grid.Column="0"
                        Text="ðŸ "
                        Command="{Binding PressHomeCommand}"
                        Style="{StaticResource GlassActionButton}"
                        HorizontalOptions="Fill"
                        HeightRequest="50" />
                <Button Grid.Column="1"
                        Text="â†"
                        Command="{Binding PressBackCommand}"
                        Style="{StaticResource GlassActionButton}"
                        HorizontalOptions="Fill"
                        HeightRequest="50"
                        FontSize="22" />
                <Button Grid.Column="2"
                        Text="â˜…"
                        Command="{Binding PressInfoCommand}"
                        Style="{StaticResource GlassActionButton}"
                        HorizontalOptions="Fill"
                        HeightRequest="50" />
                <Button Grid.Column="3"
                        Text="ðŸ”"
                        Command="{Binding PressSearchCommand}"
                        Style="{StaticResource GlassActionButton}"
                        HorizontalOptions="Fill"
                        HeightRequest="50" />
            </Grid>

            <!-- Utility Row -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <Button Grid.Column="0"
                        Text="â†º Replay"
                        Command="{Binding PressReplayCommand}"
                        Style="{StaticResource GlassUtilityButton}"
                        HorizontalOptions="Fill"
                        HeightRequest="44" />
                <Button Grid.Column="1"
                        Text="âŒ¨ Keyboard"
                        Command="{Binding ShowKeyboardCommand}"
                        Style="{StaticResource GlassUtilityButton}"
                        HorizontalOptions="Fill"
                        HeightRequest="44" />
            </Grid>
        </VerticalStackLayout>

        <!-- Keyboard Overlay -->
        <Grid Grid.RowSpan="3"
              IsVisible="{Binding IsKeyboardVisible}"
              BackgroundColor="{AppThemeBinding Light=#80FFFFFF, Dark=#80000000}">
            <Frame Style="{StaticResource GlassCard}"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"
                   WidthRequest="320"
                   Padding="20">
                <VerticalStackLayout Spacing="16">
                    <Label Text="Enter Text"
                           Style="{StaticResource TitleLabel}"
                           HorizontalOptions="Center" />

                    <Entry Placeholder="Type here..."
                           Text="{Binding KeyboardText}"
                           ReturnCommand="{Binding SendKeyboardTextCommand}" />

                    <Grid ColumnDefinitions="*,*,*" ColumnSpacing="8">
                        <Button Grid.Column="0"
                                Text="âŒ«"
                                Command="{Binding SendBackspaceCommand}"
                                Style="{StaticResource GlassUtilityButton}" />
                        <Button Grid.Column="1"
                                Text="Send"
                                Command="{Binding SendKeyboardTextCommand}"
                                Style="{StaticResource PrimaryButton}"
                                HeightRequest="40" />
                        <Button Grid.Column="2"
                                Text="Cancel"
                                Command="{Binding HideKeyboardCommand}"
                                Style="{StaticResource GlassUtilityButton}" />
                    </Grid>
                </VerticalStackLayout>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>
